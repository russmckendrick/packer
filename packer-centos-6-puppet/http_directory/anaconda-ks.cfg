# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
text
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --plaintext vagrant
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone UTC
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

# Clean out the old disk config
zerombr

# Clean out old partitions
clearpart --all --drives=sda

# Make a new partition for the volgroup
part pv.008002 --size=39000 --ondisk=sda

# Make the volgroup
volgroup VolGroup --pesize=4096 pv.008002

# Make / on the volgroup
logvol / --fstype=ext4 --name=lv_root --vgname=VolGroup --grow --size=1024 --maxsize=37000

# Setup swap on the volgroup
logvol swap --name=lv_swap --vgname=VolGroup --grow --size=2016 --maxsize=2016

# Setup the boot partition on the volgroup
part /boot --fstype=ext4 --size=500

# Location of the package data
url --url http://mirrors.usinternet.com/centos/6.5/os/x86_64/
repo --name=updates --baseurl=http://mirrors.usinternet.com/centos/6.5/updates/x86_64/
repo --name=epel --baseurl=http://download.fedoraproject.org/pub/epel/6/x86_64/
%packages --nobase
	@core
	kernel-devel
	kernel-headers  
	make
	dkms
	bzip2
	openssh-clients
	vim-enhanced
	wget
	sudo
	htop
%end

%post

		# Install Puppet
		yum -y install http://yum.puppetlabs.com/el/6/products/i386/puppetlabs-release-6-7.noarch.rpm
		yum -y install puppet

		# Turn off un-needed services
		chkconfig sendmail off
		chkconfig vbox-add-x11 off
		chkconfig smartd off
		chkconfig ntpd off
		chkconfig cupsd off
		chkconfig iptables off

		# Setup for Vagrant
		/usr/sbin/groupadd vagrant
		/usr/sbin/useradd vagrant -g vagrant -G wheel
		echo "vagrant"|passwd --stdin vagrant
		echo "vagrant        ALL=(ALL)       NOPASSWD: ALL" >> /etc/sudoers.d/vagrant
		chmod 0440 /etc/sudoers.d/vagrant

		# Installing vagrant keys
		mkdir -pm 700 /home/vagrant/.ssh
		curl -o /home/vagrant/.ssh/authorized_keys 'https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub' 
		chmod 0600 /home/vagrant/.ssh/authorized_keys
		chown -R vagrant /home/vagrant/.ssh

		# Cleanup other files we do not need
		yum -y groupremove "Dialup Networking Support" Editors "Printing Support" "Additional Development" "E-mail server"

%end

reboot
